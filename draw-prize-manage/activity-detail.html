<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>活动详情 - 定时开奖平台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; font-family:system-ui, sans-serif; background:#f0f2f5; min-height:100vh; }
    .main { margin-left:240px; padding:20px; }
    .card { background:#fff; border-radius:8px; padding:24px; margin-bottom:24px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    label { display:block; margin:16px 0 8px; font-weight:600; color:#333; }
    input, textarea, select { width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:14px; }
    input:focus, textarea:focus, select:focus { border-color:#0081f8; outline:none; box-shadow:0 0 0 2px rgba(0,129,248,0.2); }
    .form-row { display:flex; gap:20px; margin-bottom:16px; align-items:flex-start; flex-wrap:wrap; }
    .form-row label { flex:0 0 160px; text-align:right; padding-top:10px; }
    .form-row .control { flex:1; }
    .btn { padding:10px 24px; border:none; border-radius:4px; color:#fff; cursor:pointer; font-size:16px; margin-right:12px; }
    .btn-primary { background:#0081f8; }
    .btn-success { background:#52c41a; }
    .btn-danger { background:#f5222d; }
    .btn-add { background:#0081f8; }
    .prize-row, .task-row { background:#f9f9f9; padding:16px; margin:12px 0; border-radius:8px; display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .prize-row input, .task-row input, .task-row select { flex:1; min-width:120px; }
    .prize-row .btn-danger, .task-row .btn-danger { flex:0 0 auto; }
    .section-hidden { display:none; }
    .task-config { margin-top:16px; padding:16px; background:#f0f8ff; border-radius:8px; }
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:1000; }
    .modal-content { background:#fff; width:90%; max-width:600px; border-radius:12px; padding:32px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
    .hidden { display:none !important; }
    .prize-preview { margin-top:12px; padding:12px; background:#f0f5ff; border-radius:6px; font-size:14px; }
    .thanks-tip { font-size:13px; color:#666; margin-top:8px; font-style:italic; }
  </style>
</head>
<body>

<!-- 左侧固定菜单 -->
<div style="width:240px;background:#001529;color:#fff;height:100vh;position:fixed;top:0;left:0;overflow-y:auto;box-shadow:2px 0 8px rgba(0,0,0,0.3)">
  <div style="padding:20px;font-size:22px;font-weight:bold;border-bottom:1px solid #0f2a47">定时开奖平台</div>
  <ul style="list-style:none;margin:16px 0;padding:0">
    <li data-page="dashboard.html" style="padding:14px 24px;cursor:pointer;transition:0.3s" onclick="location.href='dashboard.html'">仪表盘</li>
    <li data-page="activity-list.html" style="padding:14px 24px;cursor:pointer;transition:0.3s;background:#0081f8;font-weight:bold" onclick="location.href='activity-list.html'">活动管理</li>
    <li data-page="prize-manage.html" style="padding:14px 24px;cursor:pointer;transition:0.3s" onclick="location.href='prize-manage.html'">奖品管理</li>
    <li data-page="entry-list.html" style="padding:14px 24px;cursor:pointer;transition:0.3s" onclick="location.href='entry-list.html'">参与记录</li>
    <li data-page="draw-manage.html" style="padding:14px 24px;cursor:pointer;transition:0.3s" onclick="location.href='draw-manage.html'">开奖管理</li>
    <li data-page="winner-intervene.html" style="padding:14px 24px;cursor:pointer;transition:0.3s" onclick="location.href='winner-intervene.html'">中奖干预</li>
    <li data-page="statistics.html" style="padding:14px 24px;cursor:pointer;transition:0.3s" onclick="location.href='statistics.html'">数据统计</li>
    <li style="padding:14px 24px;cursor:pointer;transition:0.3s;margin-top:40px" onclick="if(confirm('确定退出？'))location.href='dashboard.html'">退出登录</li>
  </ul>
</div>

<!-- 主内容 -->
<div class="main">
  <h1>编辑活动 #1001</h1>
  <p style="color:#888;margin-bottom:24px">创建或修改活动基本信息、开奖规则和奖品配置</p>

  <!-- 基本信息 -->
  <div class="card">
    <h2>基本信息</h2>

    <div class="form-row">
      <label>活动名称</label>
      <div class="control">
        <input type="text" value="2026双11超级福利抽奖" placeholder="请输入活动名称">
      </div>
    </div>

    <div class="form-row">
      <label>活动状态</label>
      <div class="control">
        <select>
          <option>未开始</option>
          <option selected>进行中</option>
          <option>已结束</option>
          <option>已开奖</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <label>活动时间</label>
      <div class="control" style="display:flex;gap:12px;align-items:center;">
        <input type="datetime-local" value="2026-02-01T00:00">
        <span>至</span>
        <input type="datetime-local" value="2026-02-28T23:59">
      </div>
    </div>

    <div class="form-row">
      <label>开奖时间</label>
      <div class="control">
        <input type="datetime-local" value="2026-03-05T20:00">
        <div style="font-size:12px;color:#888;margin-top:4px">必须晚于活动结束时间</div>
      </div>
    </div>

    <div class="form-row">
      <label>每人参与次数限制</label>
      <div class="control">
        <select id="entryLimitType" onchange="toggleTaskConfig()">
          <option>每天1次（推荐）</option>
          <option>活动期间总共1次</option>
          <option>无限制（可配置任务获取次数）</option>
          <option>自定义次数（需配置任务）</option>
        </select>
      </div>
    </div>

    <!-- 参与任务配置 -->
    <div id="taskConfigSection" class="section-hidden">
      <div class="card" style="margin-top:16px">
        <h3>参与任务配置（获取抽奖次数）</h3>
        <p style="color:#666;margin-bottom:16px">用户完成以下任务可获得额外抽奖次数。支持多任务叠加。</p>

        <div id="taskContainer">
          <!-- 示例任务 -->
          <div class="task-row">
            <select style="flex:0 0 180px;" onchange="toggleTaskPoints(this)">
              <option selected>分享活动页</option>
              <option>下单购买</option>
              <option>积分兑换抽奖码</option>
            </select>
            <input type="number" value="1" min="1" placeholder="完成1次得" style="flex:0 0 120px;">
            <span style="white-space:nowrap;">次抽奖机会</span>
            <input type="number" value="3" min="0" placeholder="每日上限" style="flex:0 0 120px;">
            <div class="points-config hidden" style="display:flex;align-items:center;gap:8px;flex:1;">
              <span>消耗</span>
              <input type="number" min="1" value="100" style="width:100px;" placeholder="积分">
              <span>积分 → 1次机会</span>
            </div>
            <button class="btn-danger" onclick="this.parentNode.remove()">删除任务</button>
          </div>
        </div>

        <button class="btn btn-add" style="margin-top:16px" onclick="addTaskRow()">+ 添加任务</button>
      </div>
    </div>
  </div>

  <!-- 开奖规则与干预 -->
  <div class="card">
    <h2>开奖规则与人工干预</h2>

    <div class="form-row">
      <label>默认中奖概率</label>
      <div class="control">
        <div style="display:flex;align-items:center;gap:12px;">
          <input type="range" min="0" max="100" value="100" id="winRate" style="flex:1" oninput="updateRate()">
          <strong id="rateText">100%</strong>
        </div>
        <div style="font-size:12px;color:#888;margin-top:4px">当奖品总数量 > 参与人数时，建议调低以控制成本</div>
      </div>
    </div>

    <div class="form-row">
      <label>预计中奖人数</label>
      <div class="control">
        <strong id="expectWin">45672</strong> 人
      </div>
    </div>

    <div class="form-row">
      <label>是否允许一人多中</label>
      <div class="control">
        <select>
          <option>允许（高奖级优先一人多中）</option>
          <option selected>不允许（一人最多中一个奖）</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <label>活动规则说明</label>
      <div class="control">
        <textarea rows="6">1. 参与方式：关注公众号 + 转发朋友圈 + 邀请好友得抽奖码<br>2. 每人每天最多参与3次<br>3. 开奖时间统一进行，随机匹配奖品<br>4. 最终解释权归主办方所有</textarea>
      </div>
    </div>
  </div>

  <!-- 奖品配置 -->
  <div class="card">
    <h2>奖品配置</h2>
    <p style="color:#888;margin-bottom:16px">权重越高，中奖概率越高；谢谢参与为固定兜底奖品。</p>

    <div id="prizeContainer">
      <div class="prize-row">
        <input type="text" value="一等奖" style="flex:0 0 120px;" readonly>
        <input type="text" value="iPhone 16 Pro 256GB" readonly>
        <input type="number" value="5" min="1" style="flex:0 0 120px;" readonly>
        <input type="number" value="10" min="1" style="flex:0 0 120px;" readonly>
        <button class="btn-danger" onclick="this.parentNode.remove()">删除</button>
      </div>
    </div>

    <button class="btn btn-add" style="margin-top:16px" onclick="openPrizeModal()">+ 添加奖品</button>
  </div>

  <!-- 操作按钮 -->
  <div style="text-align:right;margin-top:32px;">
    <button class="btn" style="background:#999;color:#fff" onclick="if(confirm('取消编辑？未保存内容将丢失')) history.back()">取消</button>
    <button class="btn btn-success" onclick="alert('活动信息已保存（模拟）')">保存草稿</button>
    <button class="btn btn-primary" onclick="alert('活动已发布，状态变更为进行中（模拟）')">保存并发布</button>
  </div>
</div>

  <!-- 新增：安慰奖配置 -->
    <div style="margin-top:32px;padding-top:24px;border-top:1px solid #eee">
      <h3>安慰奖配置（未中奖用户专属）</h3>
      <p style="color:#666;margin-bottom:16px">当用户未中任何奖品时，可自动发放安慰奖，提升用户体验和留存率</p>

      <div class="form-row">
        <label>是否开启安慰奖</label>
        <div class="control">
          <input type="checkbox" id="comfortEnable" checked onchange="toggleComfortFields()">
        </div>
      </div>

      <div id="comfortFields">
        <div class="form-row">
          <label>安慰奖类型</label>
          <div class="control">
            <select id="comfortType" onchange="toggleComfortDetail()">
              <option value="points">积分奖励</option>
              <option value="coupon">优惠券</option>
              <option value="redpacket">小额红包</option>
              <option value="text">自定义文案（无实际奖励）</option>
            </select>
          </div>
        </div>

        <!-- 积分奖励 -->
        <div id="comfortPoints" class="comfort-row">
          <label>奖励积分数量</label>
          <input type="number" min="1" value="50" placeholder="如：50积分">
        </div>

        <!-- 优惠券 -->
        <div id="comfortCoupon" class="comfort-row hidden">
          <label>优惠券码</label>
          <input type="text" value="COMFORT-10" placeholder="如：COMFORT-10">
        </div>

        <!-- 小额红包 -->
        <div id="comfortRedpacket" class="comfort-row hidden">
          <label>红包金额（元）</label>
          <input type="number" step="0.01" min="0.01" value="1.88" placeholder="如：1.88元">
        </div>

        <!-- 自定义文案 -->
        <div id="comfortText" class="comfort-row hidden">
          <label>安慰文案</label>
          <textarea rows="3">很遗憾未中奖～送你一个大大的抱抱！下次一定中！继续参与其他活动吧～</textarea>
        </div>

        <div class="form-row">
          <label>发放条件</label>
          <div class="control">
            <select>
              <option selected>所有未中奖用户</option>
              <option>随机 50% 未中奖用户</option>
              <option>仅首次参与未中奖用户</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <label>每日发放上限（每用户）</label>
          <div class="control">
            <input type="number" min="0" value="1" placeholder="0 = 不限">
          </div>
        </div>
      </div>
    </div>
  </div>
  
<!-- 奖品配置弹窗 -->
<div class="modal" id="prizeModal">
  <div class="modal-content">
    <h2 style="margin-top:0">添加/编辑奖品</h2>
    
    <div class="form-row">
      <label>奖级</label>
      <div class="control">
        <input type="text" id="prizeLevel" placeholder="如：一等奖、二等奖、参与奖" value="一等奖">
      </div>
    </div>

    <div class="form-row">
      <label>奖品类型</label>
      <div class="control">
        <select id="prizeType" onchange="togglePrizeFields()">
          <option value="physical">实物奖</option>
          <option value="points">积分奖</option>
          <option value="coupon">优惠券</option>
          <option value="thanks">谢谢参与（兜底）</option>
        </select>
      </div>
    </div>

    <!-- 实物奖 -->
    <div id="physicalFields" class="form-row">
      <label>实物奖品ID</label>
      <div class="control">
        <input type="text" id="physicalId" placeholder="输入系统中实物奖品ID" value="P1001" oninput="previewPhysical()">
        <div id="physicalPreview" class="prize-preview" style="display:none;">
          <strong>预览：</strong> <span id="physicalName">iPhone 16 Pro 256GB</span> | 
          ￥<span id="physicalPrice">8999</span> | 
          <img id="physicalImg" src="https://via.placeholder.com/60x60/ff9800/fff?text=iPhone" style="vertical-align:middle;width:60px;height:60px;object-fit:cover;border-radius:4px">
        </div>
      </div>
    </div>

    <!-- 积分奖 -->
    <div id="pointsFields" class="form-row hidden">
      <label>奖励积分数量</label>
      <div class="control">
        <input type="number" id="pointsAmount" min="1" placeholder="如：5000" value="5000">
      </div>
    </div>

    <!-- 优惠券 -->
    <div id="couponFields" class="form-row hidden">
      <label>优惠券码</label>
      <div class="control">
        <input type="text" id="couponCode" placeholder="如：DOUBLE11-88" value="DOUBLE11-88">
      </div>
    </div>

    <!-- 谢谢参与 -->
    <div id="thanksFields" class="form-row hidden">
      <label></label>
      <div class="control">
        <div class="thanks-tip">谢谢参与（不限数量，固定兜底奖品，所有未中奖用户均可获得）</div>
      </div>
    </div>

    <div class="form-row" id="quantityRow">
      <label>发放数量</label>
      <div class="control">
        <input type="number" id="prizeQuantity" min="1" value="10">
      </div>
    </div>

    <div class="form-row" id="weightRow">
      <label>中奖权重</label>
      <div class="control">
        <input type="number" id="prizeWeight" min="1" value="20">
      </div>
    </div>

    <div style="text-align:right;margin-top:32px;">
      <button class="btn" style="background:#999;color:#fff" onclick="closePrizeModal()">取消</button>
      <button class="btn btn-primary" onclick="savePrize()">确认添加</button>
    </div>
  </div>
</div>

<script>
// 高亮当前页面菜单项 + 悬停效果
const currentPath = window.location.pathname.split('/').pop() || 'dashboard.html';
document.querySelectorAll('li').forEach(li => {
  const target = li.dataset.page;
  if (target === currentPath) {
    li.style.background = '#0081f8';
    li.style.fontWeight = 'bold';
  }
  li.addEventListener('mouseover', () => {
    if (!li.style.background.includes('#0081f8')) li.style.background = '#0f2a47';
  });
  li.addEventListener('mouseout', () => {
    if (!li.style.background.includes('#0081f8')) li.style.background = '';
  });
});
  
// 切换安慰奖配置显示
function toggleComfortFields() {
  const enable = document.getElementById('comfortEnable').checked;
  document.getElementById('comfortFields').style.display = enable ? 'block' : 'none';
}

// 切换安慰奖类型详情
function toggleComfortDetail() {
  const type = document.getElementById('comfortType').value;
  document.getElementById('comfortPoints').classList.toggle('hidden', type !== 'points');
  document.getElementById('comfortCoupon').classList.toggle('hidden', type !== 'coupon');
  document.getElementById('comfortRedpacket').classList.toggle('hidden', type !== 'redpacket');
  document.getElementById('comfortText').classList.toggle('hidden', type !== 'text');
}
// 实时更新预计中奖人数
function updateRate() {
  const rate = document.getElementById('winRate').value;
  const total = 45672;
  document.getElementById('rateText').innerText = rate + '%';
  document.getElementById('expectWin').innerText = Math.round(total * rate / 100);
}

// 切换参与次数限制时显示/隐藏任务配置
function toggleTaskConfig() {
  const type = document.getElementById('entryLimitType').value;
  const section = document.getElementById('taskConfigSection');
  if (type === '无限制（可配置任务获取次数）' || type === '自定义次数（需配置任务）') {
    section.classList.remove('section-hidden');
  } else {
    section.classList.add('section-hidden');
  }
}

// 添加任务行
function addTaskRow() {
  const container = document.getElementById('taskContainer');
  const newRow = document.createElement('div');
  newRow.className = 'task-row';
  newRow.innerHTML = `
    <select style="flex:0 0 180px;" onchange="toggleTaskPoints(this)">
      <option>分享活动页</option>
      <option>下单购买</option>
      <option>积分兑换抽奖码</option>
    </select>
    <input type="number" value="1" min="1" placeholder="完成1次得" style="flex:0 0 120px;">
    <span style="white-space:nowrap;">次抽奖机会</span>
    <input type="number" value="3" min="0" placeholder="每日上限" style="flex:0 0 120px;">
    <div class="points-config hidden" style="display:flex;align-items:center;gap:8px;flex:1;">
      <span>消耗</span>
      <input type="number" min="1" value="100" style="width:100px;" placeholder="积分">
      <span>积分 → 1次机会</span>
    </div>
    <button class="btn-danger" onclick="this.parentNode.remove()">删除任务</button>
  `;
  container.appendChild(newRow);
}

// 切换积分兑换任务的额外字段
function toggleTaskPoints(select) {
  const row = select.parentNode;
  const pointsConfig = row.querySelector('.points-config');
  if (select.value === '积分兑换抽奖码') {
    pointsConfig.classList.remove('hidden');
    pointsConfig.style.display = 'flex';
  } else {
    pointsConfig.classList.add('hidden');
    pointsConfig.style.display = 'none';
  }
}

// 打开奖品弹窗
function openPrizeModal() {
  document.getElementById('prizeModal').style.display = 'flex';
  togglePrizeFields();
}

// 关闭奖品弹窗
function closePrizeModal() {
  document.getElementById('prizeModal').style.display = 'none';
}

// 切换奖品类型字段
function togglePrizeFields() {
  const type = document.getElementById('prizeType').value;
  document.getElementById('physicalFields').classList.toggle('hidden', type !== 'physical');
  document.getElementById('pointsFields').classList.toggle('hidden', type !== 'points');
  document.getElementById('couponFields').classList.toggle('hidden', type !== 'coupon');
  document.getElementById('thanksFields').classList.toggle('hidden', type !== 'thanks');
  document.getElementById('quantityRow').classList.toggle('hidden', type === 'thanks');
  document.getElementById('weightRow').classList.toggle('hidden', type === 'thanks');
  if (type === 'physical') previewPhysical();
}

// 模拟实物预览
function previewPhysical() {
  const id = document.getElementById('physicalId').value.trim();
  const preview = document.getElementById('physicalPreview');
  if (id === 'P1001') {
    document.getElementById('physicalName').innerText = 'iPhone 16 Pro 256GB';
    document.getElementById('physicalPrice').innerText = '8999';
    document.getElementById('physicalImg').src = 'https://via.placeholder.com/60x60/ff9800/fff?text=iPhone';
    preview.style.display = 'block';
  } else if (id) {
    document.getElementById('physicalName').innerText = '未知奖品';
    document.getElementById('physicalPrice').innerText = '0';
    document.getElementById('physicalImg').src = 'https://via.placeholder.com/60x60/ccc/fff?text=?';
    preview.style.display = 'block';
  } else {
    preview.style.display = 'none';
  }
}

// 保存奖品
function savePrize() {
  const level = document.getElementById('prizeLevel').value.trim() || '未知奖级';
  const type = document.getElementById('prizeType').value;
  let name = '';
  
  if (type === 'physical') name = `实物奖（ID: ${document.getElementById('physicalId').value || '未知'}）`;
  else if (type === 'points') name = `${document.getElementById('pointsAmount').value || 0}积分`;
  else if (type === 'coupon') name = `优惠券：${document.getElementById('couponCode').value || '未知'}`;
  else if (type === 'thanks') name = '谢谢参与（兜底）';
  
  const quantity = type === 'thanks' ? '不限' : document.getElementById('prizeQuantity').value;
  const weight = type === 'thanks' ? '—' : document.getElementById('prizeWeight').value;
  
  const container = document.getElementById('prizeContainer');
  const row = document.createElement('div');
  row.className = `prize-row ${type === 'thanks' ? 'thanks' : ''}`;
  row.innerHTML = `
    <input type="text" value="${level}" style="flex:0 0 120px;" readonly>
    <input type="text" value="${name}" readonly>
    <input type="text" value="${quantity}" style="flex:0 0 120px;" readonly>
    <input type="text" value="${weight}" style="flex:0 0 120px;" readonly>
    <button class="btn-danger" onclick="this.parentNode.remove()" ${type === 'thanks' ? 'disabled' : ''}>删除</button>
  `;
  container.appendChild(row);
  closePrizeModal();
}
</script>
</body>
</html>
